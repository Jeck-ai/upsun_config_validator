applications:
  api:
    type: 'nodejs@16'
    web:
      commands:
        start: node server.js
      locations:
        '/':
          passthru: true
    relationships:
      database: 'db:postgresql'
      cache: 'cache:redis'
      search: 'search:elasticsearch'
  worker:
    type: 'nodejs@16'
    web:
      commands:
        start: node worker.js
    relationships:
      database: 'db:postgresql'
      queue: 'queue:rabbitmq'

services:
  db:
    type: postgresql:13
    configuration:
      storage: 2GB
  cache:
    type: redis:6.0
    configuration:
      storage: 512MB
  search:
    type: elasticsearch:7.9
    configuration:
      storage: 1GB
  queue:
    type: rabbitmq:3.8
    configuration:
      storage: 512MB

routes:
  "https://{default}/":
    type: upstream
    upstream: "api:http"
    cache:
      enabled: true
      default_ttl: 3600
      headers:
        - Accept
        - Accept-Language